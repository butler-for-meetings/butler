from mongoengine import *
import datetime

class User(Document):
    email = EmailField(required=True)
    first_name = StringField(max_length=64)
    last_name = StringField(max_length=64)
    required = BooleanField(default=False)

class Task(EmbeddedDocument):
    finished = BooleanField(default=False)
    responsible = ReferenceField(User)
    start_date = DateTimeField(default=datetime.datetime.utcnow, required=True)
    end_date = DateTimeField(required=True)

class Comment(Document):
    content = StringField(required=True)
    author = User(required=True)

class Discussion(Document):
    title = StringField()
    previous_discussion = LazyReferenceField(document_type="Discussion")
    tasks = EmbeddedDocumentListField(Task)
    date = DateTimeField(required=True)
    host = ReferenceField(User)
    participants = ListField(ReferenceField(User))
    tags = ListField(StringField)
    purpose = StringField(required=True)
    background = StringField(required=True)
    main_points = ListField(StringField)
    main_points_sum = ListField(StringField)
    comments = ListField(Comment)

class Project(Document):
    participants = ListField(ReferenceField(User))
    start_date = DateTimeField(default=datetime.datetime.utcnow, required=True)
    end_date = DateTimeField(required=True)
    discussions = ListField(ReferenceField(Discussion))

class Tag(Document):
    name = StringField(required=True)
